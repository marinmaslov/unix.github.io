# ğŸš€ VjeÅ¾ba 6: Preusmjeravanje, signali

# Zadatak ğŸ“‹

Zadatak ove vjeÅ¾be je napraviti direktorij `vjezba6` i u njega kopirati `program2.c` iz proÅ¡le vjeÅ¾be. Isti je potrebno preimenovati u `program.c`. Zatim je potrebno prepraviti program na naÄin da se standardni izlaz naredbe koja se pokreÄ‡e preusmjerava u datoteku. Neka se ime datoteke zadaje kao prvi argument naredbenog retka, a iza imena datoteke slijedi sama naredba i njeni argumenti.

Primjer:
`./program ls.out ls -al`

ObjaÅ¡njenje primjera:
`./program log.out ls -al` pokreÄ‡e naredbu ls sa opcijom -al. Naredba ls se pokreÄ‡e u CHILD procesu, a njezin standardni izlaz se prusmerava u datoteku ls.out.
U PARENT procesu implementirajte signal handler za signal SIGCHLD (primjer za imlementaciju signal handlera). Nakon primanja signala, PARENT proces treba pokupiti izlazni status CHILD procesa.

Kao i u proÅ¡loj vjeÅ¾bi potrbno je napisati `Makefile` datoteku te pokrenitu `make` pravilo za prevoÄ‘enje i povezivanje programa.

U konaÄnici direktorij `vjezba6` u kojem se nalaze svi vaÅ¡i programi i `Makefile` datoteka komprimirajte u `.tar` datoteku te istu uÄitajte na elearning.

___

## Upute ğŸ§­

Za poÄetak stvroite direktorij `vjezba6`.

Zatim kopirajte `program2.c` iz proÅ¡le vjeÅ¾be (iz direktorija `vjezba5`) u novonastali direktorij. Preimenovanje datoteke u `program.c` moÅ¾ete obaviti odmah u naredbi `cp` ili nakon kopiranja naredbom `mv`.

Nakon uspjeÅ¡nog kopiranja programa potrebno je program prepravit, no prvo se prisjetimo samog programa:

Program kao argumente naredbenog retka prima proizvoljnu naredbu sa njenim argumentima. Funkcija `fork()` stvara novi proces, nakon Äega se memorijska slika `CHILD` procesa zamjenjuje novim programom pozivom funkcije `execvp()`. Funkcija `execvp()` argumente naredbenog retka preuzima u obliku polja pokazivaÄa, na naÄin na koji ih funkcija `main()` u novopokrenutom programu i prima. U naÅ¡em sluÄaju, ime programa je drugi argument naredbenog retka (argv[1] - odmah iza naredbe kojom pozivamo program), a polke pokazivaÄa koji se proslijeÄ‘uju kao argumenti funkcije main novopokrenutog programa zapoÄinje na adresi &argv[1]. Na ovaj naÄin, novopokrenutom programu se proslijeÄ‘uje lista argumenata naredbenog retka bez obzira na njihov broj.

### `program.c`
``` c
#include <stdio.h>
#include <unistd.h>
#include <wait.h>

int main(int argc, char *argv[]) {
  int pid, cpid;

  if (argc < 2) {
    printf("Koristenje: %s NAREDBA [argumenti] ...\n", argv[0]);
    return 0;
  }

  pid = fork();
  if (pid == -1) {              // Error
    perror("fork");
    return 0;
  } else if (pid != 0) {        // Parent
    cpid = wait(NULL);
    printf("[PID %5d]: Terminated\n", cpid);
  } else {
    execvp(argv[1], &argv[1]);
  }

  return 0;

}
```
___

Program se sada moÅ¾e prepraviti tako da `PARENT` proces nastavlja s radom neovisno o `CHILD` procesu. Izlazni status `CHILD` procesa `PARENT` proces preuzima funkcijom `wait()` koja se poziva iz `signal handler` funkcije `child_handler`. Signal handler postavljen je funkcijom `signal()`.

``` c
#include <stdio.h>
#include <unistd.h>
#include <wait.h>


int cpid = 0;

static void chld_handler(int signo) {
  cpid = wait(NULL);
}

int main(int argc, char **argv) {
  int pid;

  if (argc < 2) {
    printf("Koristenje: %s NAREDBA [argumenti] ...\n", argv[0]);
    return 0;
  }

  signal(SIGCHLD, chld_handler);

  pid = fork();
  if (pid == -1) {              // Error
    perror("fork");
    return 0;
  } else if (pid == 0) {        // Child
    execvp(argv[1], &argv[1]);
  }

  while (!cpid) {
    pause();
  }
  printf("[PID %5d]: Terminated\n", cpid);

  return 0;
}
```
___

Ono Å¡to je preostalo je napraviti redirekciju ispisa u datoteku, a to radimo na sljedeÄ‡i naÄin:


___

U nastavku napiÅ¡ite `Makefile` i pravilo `program` za prevoÄ‘enje i povezivanje izmjenjenog programa.

Nakon izvrÅ¡avanja `make` pravila, testirajte vaÅ¡ program s:

`program2`
``` bash
./program ls.out ls -al
```


Sve Å¡to vam preostaje je da kao i u proÅ¡loj vjeÅ¾bi napravite `.tar` datoteku od direktorija `vjezba5` te istu uÄitate na elearning (hint: `.tar` datoteku Ä‡ete prebaciti na lokalno raÄunalo pomoÄ‡u WinSCP programa). 
